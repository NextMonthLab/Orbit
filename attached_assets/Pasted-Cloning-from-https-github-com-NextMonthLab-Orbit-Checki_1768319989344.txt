Cloning from https://github.com/NextMonthLab/Orbit
==> Checking out commit 35c23606ebfc9f9683916f8c633f9e42c963d4af in branch main
==> Requesting Node.js version >=20.0.0
==> Using Node.js version 25.3.0 via /opt/render/project/src/package.json
==> Docs on specifying a Node.js version: https://render.com/docs/node-version
==> Running build command 'npm install; npm run build'...
added 869 packages, and audited 870 packages in 37s
100 packages are looking for funding
  run `npm fund` for details
10 vulnerabilities (2 low, 4 moderate, 4 high)
To address issues that do not require attention, run:
  npm audit fix
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
> rest-express@1.0.0 build
> tsx script/build.ts
building client...
vite v7.1.12 building for production...
transforming...
âœ“ 2815 modules transformed.
rendering chunks...
[meta-images] no Replit deployment domain found, skipping meta tag updates
computing gzip size...
../dist/public/index.html                                             2.58 kB â”‚ gzip:   0.86 kB
../dist/public/assets/business_professiona_dba1a455-B-roPHxo.jpg    139.02 kB
../dist/public/assets/creative_writer_work_c38a4245-oAsYai_O.jpg    165.75 kB
../dist/public/assets/teacher_educator_in__8c1ca5d7-D7lUb8D8.jpg    205.94 kB
../dist/public/assets/filmmaker_director_r_bff3ccae-C5IZ-AGo.jpg    208.51 kB
../dist/public/assets/engineer_working_in__08fad5a8-DZQp2Iel.jpg    356.82 kB
../dist/public/assets/business-orbit-logo-cropped-4uS0cbrF.png      541.72 kB
../dist/public/assets/index-BIc3D5_e.css                            285.38 kB â”‚ gzip:  35.14 kB
../dist/public/assets/browser-Bz7HPTjf.js                            25.78 kB â”‚ gzip:  10.13 kB
../dist/public/assets/index-BOE8sOrd.js                           1,856.01 kB â”‚ gzip: 464.29 kB
(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 11.00s
building server...
â–² [WARNING] "import.meta" is not available with the "cjs" output format and will be empty [empty-import-meta]
    server/scripts/seedDemoOrbits.ts:1187:21:
      1187 â”‚ const isMainModule = import.meta.url === `file://${process.argv[...
           â•µ                      ~~~~~~~~~~~
  You need to set the output format to "esm" for "import.meta" to work correctly.
1 warning
  dist/index.cjs  2.2mb âš ï¸
âš¡ Done in 982ms
==> Uploading build...
==> Uploaded in 61.1s. Compression took 13.0s
==> Build successful ðŸŽ‰
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Deploying...
==> Running 'npm run start'
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:91
${ow(t)}`);return{...J,id:L,type:Z,function:{...Ce,name:ce,arguments:ue}}})}}:{...w,message:{...D,content:x,role:U,refusal:u.refusal??null},finish_reason:m,index:g,logprobs:v}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return oG(l,e)}function ow(t){return JSON.stringify(t)}var $r,Ma,kd,No,oA,iw,cA,lA,uA,aw,dA,gG,xl,cw=O(()=>{Ls();hG();di();Ph();aA();tA();xl=class t extends Od{constructor(e){super(),$r.add(this),Ma.set(this,void 0),kd.set(this,void 0),No.set(this,void 0),Ke(this,Ma,e,"f"),Ke(this,kd,[],"f")}get currentChatCompletionSnapshot(){return X(this,No,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let s=new t(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),X(this,$r,"m",oA).call(this);let i=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of i)X(this,$r,"m",cA).call(this,a);if(i.controller.signal?.aborted)throw new _r;return this._addChatCompletion(X(this,$r,"m",aw).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),X(this,$r,"m",oA).call(this),this._connected();let s=zi.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(X(this,$r,"m",aw).call(this)),X(this,$r,"m",cA).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new _r;return this._addChatCompletion(X(this,$r,"m",aw).call(this))}[(Ma=new WeakMap,kd=new WeakMap,No=new WeakMap,$r=new WeakSet,oA=function(){this.ended||Ke(this,No,void 0,"f")},iw=function(r){let n=X(this,kd,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},X(this,kd,"f")[r.index]=n,n)},cA=function(r){if(this.ended)return;let n=X(this,$r,"m",gG).call(this,r);this._emit("chunk",r,n);for(let s of r.choices){let i=n.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=X(this,$r,"m",iw).call(this,i);i.finish_reason&&(X(this,$r,"m",uA).call(this,i),a.current_tool_call_index!=null&&X(this,$r,"m",lA).call(this,i,a.current_tool_call_index));for(let o of s.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(X(this,$r,"m",uA).call(this,i),a.current_tool_call_index!=null&&X(this,$r,"m",lA).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let l=i.message.tool_calls?.[o.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:o.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(l?.type,void 0))}}},lA=function(r,n){if(X(this,$r,"m",iw).call(this,r).done_tool_calls.has(n))return;let i=r.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=X(this,Ma,"f")?.tools?.find(o=>xh(o)&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:wl(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},uA=function(r){let n=X(this,$r,"m",iw).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let s=X(this,$r,"m",dA).call(this);this._emit("content.done",{content:r.message.content,parsed:s?s.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},aw=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");let r=X(this,No,"f");if(!r)throw new Ae("request ended without sending any chunks");return Ke(this,No,void 0,"f"),Ke(this,kd,[],"f"),_1e(r,X(this,Ma,"f"))},dA=function(){let r=X(this,Ma,"f")?.response_format;return Sh(r)?r:null},gG=function(r){var n,s,i,a;let o=X(this,No,"f"),{choices:l,...u}=r;o?Object.assign(o,u):o=Ke(this,No,{...u,choices:[]},"f");for(let{delta:m,finish_reason:g,index:v,logprobs:w=null,...x}of r.choices){let E=o.choices[v];if(E||(E=o.choices[v]={finish_reason:g,index:v,message:{},logprobs:w,...x}),w)if(!E.logprobs)E.logprobs=Object.assign({},w);else{let{content:Z,refusal:L,...J}=w;Object.assign(E.logprobs,J),Z&&((n=E.logprobs).content??(n.content=[]),E.logprobs.content.push(...Z)),L&&((s=E.logprobs).refusal??(s.refusal=[]),E.logprobs.refusal.push(...L))}if(g&&(E.finish_reason=g,X(this,Ma,"f")&&HC(X(this,Ma,"f")))){if(g==="length")throw new xd;if(g==="content_filter")throw new Sd}if(Object.assign(E,x),!m)continue;let{content:C,refusal:D,function_call:U,role:N,tool_calls:$,...Q}=m;if(Object.assign(E.message,Q),D&&(E.message.refusal=(E.message.refusal||"")+D),N&&(E.message.role=N),U&&(E.message.function_call?(U.name&&(E.message.function_call.name=U.name),U.arguments&&((i=E.message.function_call).arguments??(i.arguments=""),E.message.function_call.arguments+=U.arguments)):E.message.function_call=U),C&&(E.message.content=(E.message.content||"")+C,!E.message.refusal&&X(this,$r,"m",dA).call(this)&&(E.message.parsed=iA(E.message.content))),$){E.message.tool_calls||(E.message.tool_calls=[]);for(let{index:Z,id:L,type:J,function:ue,...ce}of $){let Ce=(a=E.message.tool_calls)[Z]??(a[Z]={});Object.assign(Ce,ce),L&&(Ce.id=L),J&&(Ce.type=J),ue&&(Ce.function??(Ce.function={name:ue.name??"",arguments:""})),ue?.name&&(Ce.function.name=ue.name),ue?.arguments&&(Ce.function.arguments+=ue.arguments,cG(X(this,Ma,"f"),Ce)&&(Ce.function.parsed_arguments=iA(Ce.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new zi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}});var Oh,pA=O(()=>{cw();Oh=class t extends xl{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let s=new t(r),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,i)),s}}});var ja,kh=O(()=>{We();Jv();Jv();Qt();It();rA();pA();cw();Ph();pA();YC();cw();rA();ja=class extends ae{constructor(){super(...arguments),this.messages=new vl(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(se`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(se`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/chat/completions/${e}`,r)}parse(e,r){return uG(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>_h(n,e))}runTools(e,r){return e.stream?Oh.runTools(this._client,e,r):Ah.runTools(this._client,e,r)}stream(e,r){return xl.createChatCompletion(this._client,e,r)}};ja.Messages=vl});var Mo,mA=O(()=>{We();kh();kh();Mo=class extends ae{constructor(){super(...arguments),this.completions=new ja(this._client)}};Mo.Completions=ja});var yG=O(()=>{kh();kh();Jv()});var bG=O(()=>{mA();yG()});var vG=O(()=>{});function*I1e(t){if(!t)return;if(wG in t){let{values:n,nulls:s}=t;yield*n.entries();for(let i of s)yield[i,null];return}let e=!1,r;t instanceof Headers?r=t.entries():SC(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let i=SC(n[1])?n[1]:[n[1]],a=!1;for(let o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}var wG,xe,ir=O(()=>{Oa();wG=Symbol("brand.privateNullableHeaders");xe=t=>{let e=new Headers,r=new Set;for(let n of t){let s=new Set;for(let[i,a]of I1e(n)){let o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),r.add(o)):(e.append(i,a),r.delete(o))}}return{[wG]:!0,values:e,nulls:r}}});var Rd,fA=O(()=>{We();ir();Rd=class extends ae{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:xe([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}}});var Nd,hA=O(()=>{We();Wi();Nd=class extends ae{create(e,r){return this._client.post("/audio/transcriptions",gs({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}});var Md,gA=O(()=>{We();Wi();Md=class extends ae{create(e,r){return this._client.post("/audio/translations",gs({body:e,...r,__metadata:{model:e.model}},this._client))}}});var Ki,yA=O(()=>{We();fA();fA();hA();hA();gA();gA();Ki=class extends ae{constructor(){super(...arguments),this.transcriptions=new Nd(this._client),this.translations=new Md(this._client),this.speech=new Rd(this._client)}};Ki.Transcriptions=Nd;Ki.Translations=Md;Ki.Speech=Rd});var Sl,bA=O(()=>{We();Qt();It();Sl=class extends ae{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(se`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",pt,{query:e,...r})}cancel(e,r){return this._client.post(se`/batches/${e}/cancel`,r)}}});var jd,vA=O(()=>{We();Qt();ir();It();jd=class extends ae{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/assistants/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/assistants/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",pt,{query:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(se`/assistants/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var Dd,wA=O(()=>{We();ir();Dd=class extends ae{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var Ld,xA=O(()=>{We();ir();Ld=class extends ae{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var jo,SA=O(()=>{We();wA();wA();xA();xA();jo=class extends ae{constructor(){super(...arguments),this.sessions=new Dd(this._client),this.transcriptionSessions=new Ld(this._client)}};jo.Sessions=Dd;jo.TranscriptionSessions=Ld});var $d,_A=O(()=>{We();ir();It();$d=class extends ae{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(se`/chatkit/sessions/${e}/cancel`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}}});var Ud,PA=O(()=>{We();Qt();ir();It();Ud=class extends ae{retrieve(e,r){return this._client.get(se`/chatkit/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Ra,{query:e,...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(se`/chatkit/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(se`/chatkit/threads/${e}/items`,Ra,{query:r,...n,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}});var Do,IA=O(()=>{We();_A();_A();PA();PA();Do=class extends ae{constructor(){super(...arguments),this.sessions=new $d(this._client),this.threads=new Ud(this._client)}};Do.Sessions=$d;Do.Threads=Ud});var Bd,EA=O(()=>{We();Qt();ir();It();Bd=class extends ae{create(e,r,n){return this._client.post(se`/threads/${e}/messages`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:s}=r;return this._client.get(se`/threads/${s}/messages/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/messages/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/threads/${e}/messages`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:s}=r;return this._client.delete(se`/threads/${s}/messages/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var qd,TA=O(()=>{We();Qt();ir();It();qd=class extends ae{retrieve(e,r,n){let{thread_id:s,run_id:i,...a}=r;return this._client.get(se`/threads/${s}/runs/${i}/steps/${e}`,{query:a,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:s,...i}=r;return this._client.getAPIList(se`/threads/${s}/runs/${e}/steps`,pt,{query:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var xG,SG=O(()=>{Fi();Gv();xG=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}}});var pi,CA=O(()=>{pi=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()}});var Rh=O(()=>{Oa();SG();CA();hh();xC();Pd()});var cn,Pl,AA,Qi,lw,mi,Il,Fd,_l,pw,ys,uw,dw,jh,Nh,Mh,_G,PG,IG,EG,TG,CG,AG,Da,OA=O(()=>{Ls();aA();di();nw();Rh();Da=class extends Ro{constructor(){super(...arguments),cn.add(this),AA.set(this,[]),Qi.set(this,{}),lw.set(this,{}),mi.set(this,void 0),Il.set(this,void 0),Fd.set(this,void 0),_l.set(this,void 0),pw.set(this,void 0),ys.set(this,void 0),uw.set(this,void 0),dw.set(this,void 0),jh.set(this,void 0)}[(AA=new WeakMap,Qi=new WeakMap,lw=new WeakMap,mi=new WeakMap,Il=new WeakMap,Fd=new WeakMap,_l=new WeakMap,pw=new WeakMap,ys=new WeakMap,uw=new WeakMap,dw=new WeakMap,jh=new WeakMap,cn=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new Pl;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=zi.fromReadableStream(e,this.controller);for await(let i of s)X(this,cn,"m",Nh).call(this,i);if(s.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}toReadableStream(){return new zi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s){let i=new Pl;return i._run(()=>i._runToolAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,r,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(r,a,{...s,signal:this.controller.signal});this._connected();for await(let l of o)X(this,cn,"m",Nh).call(this,l);if(o.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}static createThreadAssistantStream(e,r,n){let s=new Pl;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){let i=new Pl;return i._run(()=>i._runAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return X(this,uw,"f")}currentRun(){return X(this,dw,"f")}currentMessageSnapshot(){return X(this,mi,"f")}currentRunStepSnapshot(){return X(this,jh,"f")}async finalRunSteps(){return await this.done(),Object.values(X(this,Qi,"f"))}async finalMessages(){return await this.done(),Object.values(X(this,lw,"f"))}async finalRun(){if(await this.done(),!X(this,Il,"f"))throw Error("Final run was not received.");return X(this,Il,"f")}async _createThreadAssistantStream(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let o of a)X(this,cn,"m",Nh).call(this,o);if(a.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}async _createAssistantStream(e,r,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(r,a,{...s,signal:this.controller.signal});this._connected();for await(let l of o)X(this,cn,"m",Nh).call(this,l);if(o.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}static accumulateDelta(e,r){for(let[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(_d(i)&&_d(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!_d(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s){return await this._createToolAssistantStream(r,e,n,s)}};Pl=Da,Nh=function(e){if(!this.ended)switch(Ke(this,uw,e,"f"),X(this,cn,"m",IG).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":X(this,cn,"m",AG).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":X(this,cn,"m",PG).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":X(this,cn,"m",_G).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Mh=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");if(!X(this,Il,"f"))throw Error("Final run has not been received");return X(this,Il,"f")},_G=function(e){let[r,n]=X(this,cn,"m",TG).call(this,e,X(this,mi,"f"));Ke(this,mi,r,"f"),X(this,lw,"f")[r.id]=r;for(let s of n){let i=r.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=r.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=X(this,Fd,"f")){if(X(this,_l,"f"))switch(X(this,_l,"f").type){case"text":this._emit("textDone",X(this,_l,"f").text,X(this,mi,"f"));break;case"image_file":this._emit("imageFileDone",X(this,_l,"f").image_file,X(this,mi,"f"));break}Ke(this,Fd,s.index,"f")}Ke(this,_l,r.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(X(this,Fd,"f")!==void 0){let s=e.data.content[X(this,Fd,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,X(this,mi,"f"));break;case"text":this._emit("textDone",s.text,X(this,mi,"f"));break}}X(this,mi,"f")&&this._emit("messageDone",e.data),Ke(this,mi,void 0,"f")}},PG=function(e){let r=X(this,cn,"m",EG).call(this,e);switch(Ke(this,jh,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==X(this,pw,"f")?this._emit("toolCallDelta",i,r.step_details.tool_calls[i.index]):(X(this,ys,"f")&&this._emit("toolCallDone",X(this,ys,"f")),Ke(this,pw,i.index,"f"),Ke(this,ys,r.step_details.tool_calls[i.index],"f"),X(this,ys,"f")&&this._emit("toolCallCreated",X(this,ys,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ke(this,jh,void 0,"f"),e.data.step_details.type=="tool_calls"&&X(this,ys,"f")&&(this._emit("toolCallDone",X(this,ys,"f")),Ke(this,ys,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},IG=function(e){X(this,AA,"f").push(e),this._emit("event",e)},EG=function(e){switch(e.event){case"thread.run.step.created":return X(this,Qi,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=X(this,Qi,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=Pl.accumulateDelta(r,n.delta);X(this,Qi,"f")[e.data.id]=s}return X(this,Qi,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":X(this,Qi,"f")[e.data.id]=e.data;break}if(X(this,Qi,"f")[e.data.id])return X(this,Qi,"f")[e.data.id];throw new Error("No snapshot available")},TG=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in r.content){let a=r.content[i.index];r.content[i.index]=X(this,cn,"m",CG).call(this,i,a)}else r.content[i.index]=i,n.push(i);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},CG=function(e,r){return Pl.accumulateDelta(r,e)},AG=function(e){switch(Ke(this,dw,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Ke(this,Il,e.data,"f"),X(this,ys,"f")&&(this._emit("toolCallDone",X(this,ys,"f")),Ke(this,ys,void 0,"f"));break;case"thread.run.cancelling":break}}});var El,kA=O(()=>{We();TA();TA();Qt();ir();OA();Pd();It();El=class extends ae{constructor(){super(...arguments),this.steps=new qd(this._client)}create(e,r,n){let{include:s,...i}=r;return this._client.post(se`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:s}=r;return this._client.get(se`/threads/${s}/runs/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/runs/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/threads/${e}/runs`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:s}=r;return this._client.post(se`/threads/${s}/runs/${e}/cancel`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(s.id,{thread_id:e},n)}createAndStream(e,r,n){return Da.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,r,n){return Da.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let s=await this.submitToolOutputs(e,r,n);return await this.poll(s.id,r,n)}submitToolOutputsStream(e,r,n){return Da.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};El.Steps=qd});var Lo,RA=O(()=>{We();EA();EA();kA();kA();ir();OA();It();Lo=class extends ae{constructor(){super(...arguments),this.runs=new El(this._client),this.messages=new Bd(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/threads/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(se`/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Da.createThreadAssistantStream(e,this._client.beta.threads,r)}};Lo.Runs=El;Lo.Messages=Bd});var fi,NA=O(()=>{We();vA();vA();SA();SA();IA();IA();RA();RA();fi=class extends ae{constructor(){super(...arguments),this.realtime=new jo(this._client),this.chatkit=new Do(this._client),this.assistants=new jd(this._client),this.threads=new Lo(this._client)}};fi.Realtime=jo;fi.ChatKit=Do;fi.Assistants=jd;fi.Threads=Lo});var Tl,MA=O(()=>{We();Tl=class extends ae{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}}});var Vd,jA=O(()=>{We();ir();It();Vd=class extends ae{retrieve(e,r,n){let{container_id:s}=r;return this._client.get(se`/containers/${s}/files/${e}/content`,{...n,headers:xe([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}});var Cl,DA=O(()=>{We();jA();jA();Qt();ir();Wi();It();Cl=class extends ae{constructor(){super(...arguments),this.content=new Vd(this._client)}create(e,r,n){return this._client.post(se`/containers/${e}/files`,gs({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:s}=r;return this._client.get(se`/containers/${s}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(se`/containers/${e}/files`,pt,{query:r,...n})}delete(e,r,n){let{container_id:s}=r;return this._client.delete(se`/containers/${s}/files/${e}`,{...n,headers:xe([{Accept:"*/*"},n?.headers])})}};Cl.Content=Vd});var $o,LA=O(()=>{We();DA();DA();Qt();ir();It();$o=class extends ae{constructor(){super(...arguments),this.files=new Cl(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(se`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/containers/${e}`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}};$o.Files=Cl});var Gd,$A=O(()=>{We();Qt();It();Gd=class extends ae{create(e,r,n){let{include:s,...i}=r;return this._client.post(se`/conversations/${e}/items`,{query:{include:s},body:i,...n})}retrieve(e,r,n){let{conversation_id:s,...i}=r;return this._client.get(se`/conversations/${s}/items/${e}`,{query:i,...n})}list(e,r={},n){return this._client.getAPIList(se`/conversations/${e}/items`,Ra,{query:r,...n})}delete(e,r,n){let{conversation_id:s}=r;return this._client.delete(se`/conversations/${s}/items/${e}`,n)}}});var Uo,UA=O(()=>{We();$A();$A();It();Uo=class extends ae{constructor(){super(...arguments),this.items=new Gd(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(se`/conversations/${e}`,r)}update(e,r,n){return this._client.post(se`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(se`/conversations/${e}`,r)}};Uo.Items=Gd});var Al,BA=O(()=>{We();Rh();Al=class extends ae{create(e,r){let n=!!e.encoding_format,s=n?e.encoding_format:"base64";n&&Pr(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...r});return n?i:(Pr(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let l=o.embedding;o.embedding=xG(l)}),a)))}}});var zd,qA=O(()=>{We();Qt();It();zd=class extends ae{retrieve(e,r,n){let{eval_id:s,run_id:i}=r;return this._client.get(se`/evals/${s}/runs/${i}/output_items/${e}`,n)}list(e,r,n){let{eval_id:s,...i}=r;return this._client.getAPIList(se`/evals/${s}/runs/${e}/output_items`,pt,{query:i,...n})}}});var Ol,FA=O(()=>{We();qA();qA();Qt();It();Ol=class extends ae{constructor(){super(...arguments),this.outputItems=new zd(this._client)}create(e,r,n){return this._client.post(se`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:s}=r;return this._client.get(se`/evals/${s}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(se`/evals/${e}/runs`,pt,{query:r,...n})}delete(e,r,n){let{eval_id:s}=r;return this._client.delete(se`/evals/${s}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:s}=r;return this._client.post(se`/evals/${s}/runs/${e}`,n)}};Ol.OutputItems=zd});var Bo,VA=O(()=>{We();FA();FA();Qt();It();Bo=class extends ae{constructor(){super(...arguments),this.runs=new Ol(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(se`/evals/${e}`,r)}update(e,r,n){return this._client.post(se`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/evals/${e}`,r)}};Bo.Runs=Ol});var kl,GA=O(()=>{We();Qt();ir();Pd();di();Wi();It();kl=class extends ae{create(e,r){return this._client.post("/files",gs({body:e,...r},this._client))}retrieve(e,r){return this._client.get(se`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/files/${e}`,r)}content(e,r){return this._client.get(se`/files/${e}/content`,{...r,headers:xe([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Vi(r),a=await this.retrieve(e),Date.now()-i>n)throw new Aa({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}});var Hd,zA=O(()=>{We();Hd=class extends ae{}});var Wd,HA=O(()=>{We();Wd=class extends ae{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}}});var Rl,WA=O(()=>{We();HA();HA();Rl=class extends ae{constructor(){super(...arguments),this.graders=new Wd(this._client)}};Rl.Graders=Wd});var Kd,KA=O(()=>{We();Qt();It();Kd=class extends ae{create(e,r,n){return this._client.getAPIList(se`/fine_tuning/checkpoints/${e}/permissions`,Hi,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(se`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:s}=r;return this._client.delete(se`/fine_tuning/checkpoints/${s}/permissions/${e}`,n)}}});var Nl,QA=O(()=>{We();KA();KA();Nl=class extends ae{constructor(){super(...arguments),this.permissions=new Kd(this._client)}};Nl.Permissions=Kd});var Qd,YA=O(()=>{We();Qt();It();Qd=class extends ae{list(e,r={},n){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/checkpoints`,pt,{query:r,...n})}}});var Ml,JA=O(()=>{We();YA();YA();Qt();It();Ml=class extends ae{constructor(){super(...arguments),this.checkpoints=new Qd(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(se`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",pt,{query:e,...r})}cancel(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/events`,pt,{query:r,...n})}pause(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/resume`,r)}};Ml.Checkpoints=Qd});var hi,XA=O(()=>{We();zA();zA();WA();WA();QA();QA();JA();JA();hi=class extends ae{constructor(){super(...arguments),this.methods=new Hd(this._client),this.jobs=new Ml(this._client),this.checkpoints=new Nl(this._client),this.alpha=new Rl(this._client)}};hi.Methods=Hd;hi.Jobs=Ml;hi.Checkpoints=Nl;hi.Alpha=Rl});var Yd,ZA=O(()=>{We();Yd=class extends ae{}});var qo,eO=O(()=>{We();ZA();ZA();qo=class extends ae{constructor(){super(...arguments),this.graderModels=new Yd(this._client)}};qo.GraderModels=Yd});var jl,tO=O(()=>{We();Wi();jl=class extends ae{createVariation(e,r){return this._client.post("/images/variations",gs({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",gs({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}}});var Dl,rO=O(()=>{We();Qt();It();Dl=class extends ae{retrieve(e,r){return this._client.get(se`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Hi,e)}delete(e,r){return this._client.delete(se`/models/${e}`,r)}}});var Ll,nO=O(()=>{We();Ll=class extends ae{create(e,r){return this._client.post("/moderations",{body:e,...r})}}});var Jd,sO=O(()=>{We();ir();It();Jd=class extends ae{accept(e,r,n){return this._client.post(se`/realtime/calls/${e}/accept`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(se`/realtime/calls/${e}/hangup`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(se`/realtime/calls/${e}/refer`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(se`/realtime/calls/${e}/reject`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}}});var Xd,iO=O(()=>{We();Xd=class extends ae{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}}});var La,aO=O(()=>{We();sO();sO();iO();iO();La=class extends ae{constructor(){super(...arguments),this.clientSecrets=new Xd(this._client),this.calls=new Jd(this._client)}};La.ClientSecrets=Xd;La.Calls=Jd});function OG(t,e){return!e||!rIe(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:oO(t,e)}function oO(t,e){let r=t.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:iIe(e,s)};if(s.type==="message"){let i=s.content.map(a=>a.type==="output_text"?{...a,parsed:tIe(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||mw(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let s of n.output)if(s.type==="message"){for(let i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function tIe(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function rIe(t){return!!Sh(t.text?.format)}function nIe(t){return t?.$brand==="auto-parseable-tool"}function sIe(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function iIe(t,e){let r=sIe(t.tools??[],e.name);return{...e,...e,parsed_arguments:nIe(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function mw(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var cO=O(()=>{di();Ph()});function aIe(t,e){return OG(t,e)}var Zd,fw,Fo,hw,kG,RG,NG,MG,gw,jG=O(()=>{Ls();di();nw();cO();gw=class t extends Ro{constructor(e){super(),Zd.add(this),fw.set(this,void 0),Fo.set(this,void 0),hw.set(this,void 0),Ke(this,fw,e,"f")}static createResponse(e,r,n){let s=new t(r);return s._run(()=>s._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),X(this,Zd,"m",kG).call(this);let i,a=null;"response_id"in r?(i=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):i=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of i)X(this,Zd,"m",RG).call(this,o,a);if(i.controller.signal?.aborted)throw new _r;return X(this,Zd,"m",NG).call(this)}[(fw=new WeakMap,Fo=new WeakMap,hw=new WeakMap,Zd=new WeakSet,kG=function(){this.ended||Ke(this,Fo,void 0,"f")},RG=function(r,n){if(this.ended)return;let s=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},i=X(this,Zd,"m",MG).call(this,r);switch(s("event",r),r.type){case"response.output_text.delta":{let a=i.output[r.output_index];if(!a)throw new Ae(`missing output at index ${r.output_index}`);if(a.type==="message"){let o=a.content[r.content_index];if(!o)throw new Ae(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new Ae(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[r.output_index];if(!a)throw new Ae(`missing output at index ${r.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:s(r.type,r);break}},NG=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");let r=X(this,Fo,"f");if(!r)throw new Ae("request ended without sending any events");Ke(this,Fo,void 0,"f");let n=aIe(r,X(this,fw,"f"));return Ke(this,hw,n,"f"),n},MG=function(r){let n=X(this,Fo,"f");if(!n){if(r.type!=="response.created")throw new Ae(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=Ke(this,Fo,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);let i=s.type,a=r.part;i==="message"&&a.type!=="reasoning_text"?s.content.push(a):i==="reasoning"&&a.type==="reasoning_text"&&(s.content||(s.content=[]),s.content.push(a));break}case"response.output_text.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);if(s.type==="message"){let i=s.content[r.content_index];if(!i)throw new Ae(`missing content at index ${r.content_index}`);if(i.type!=="output_text")throw new Ae(`expected content to be 'output_text', got ${i.type}`);i.text+=r.delta}break}case"response.function_call_arguments.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);s.type==="function_call"&&(s.arguments+=r.delta);break}case"response.reasoning_text.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);if(s.type==="reasoning"){let i=s.content?.[r.content_index];if(!i)throw new Ae(`missing content at index ${r.content_index}`);if(i.type!=="reasoning_text")throw new Ae(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=r.delta}break}case"response.completed":{Ke(this,Fo,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=X(this,hw,"f");if(!e)throw new Ae("stream ended without producing a ChatCompletion");return e}}});var ep,lO=O(()=>{We();Qt();It();ep=class extends ae{list(e,r={},n){return this._client.getAPIList(se`/responses/${e}/input_items`,pt,{query:r,...n})}}});var tp,uO=O(()=>{We();tp=class extends ae{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}}});var $a,dO=O(()=>{cO();jG();We();lO();lO();uO();uO();ir();It();$a=class extends ae{constructor(){super(...arguments),this.inputItems=new ep(this._client),this.inputTokens=new tp(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&mw(n),n))}retrieve(e,r={},n){return this._client.get(se`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&mw(s),s))}delete(e,r){return this._client.delete(se`/responses/${e}`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>oO(n,e))}stream(e,r){return gw.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(se`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};$a.InputItems=ep;$a.InputTokens=tp});var rp,pO=O(()=>{We();Wi();It();rp=class extends ae{create(e,r,n){return this._client.post(se`/uploads/${e}/parts`,gs({body:r,...n},this._client))}}});var Vo,mO=O(()=>{We();pO();pO();It();Vo=class extends ae{constructor(){super(...arguments),this.parts=new rp(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(se`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(se`/uploads/${e}/complete`,{body:r,...n})}};Vo.Parts=rp});var DG,LG=O(()=>{DG=async t=>{let e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(let s of r)console.error(s.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n}});var np,fO=O(()=>{We();Qt();ir();Pd();LG();It();np=class extends ae{create(e,r,n){return this._client.post(se`/vector_stores/${e}/file_batches`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:s}=r;return this._client.get(se`/vector_stores/${s}/file_batches/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:s}=r;return this._client.post(se`/vector_stores/${s}/file_batches/${e}/cancel`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n){let{vector_store_id:s,...i}=r;return this._client.getAPIList(se`/vector_stores/${s}/file_batches/${e}/files`,pt,{query:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,r.length),o=this._client,l=r.values(),u=[...n];async function m(v){for(let w of v){let x=await o.files.create({file:w,purpose:"assistants"},s);u.push(x.id)}}let g=Array(a).fill(l).map(m);return await DG(g),await this.createAndPoll(e,{file_ids:u})}}});var sp,hO=O(()=>{We();Qt();ir();Rh();It();sp=class extends ae{create(e,r,n){return this._client.post(se`/vector_stores/${e}/files`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:s}=r;return this._client.get(se`/vector_stores/${s}/files/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:s,...i}=r;return this._client.post(se`/vector_stores/${s}/files/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/vector_stores/${e}/files`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:s}=r;return this._client.delete(se`/vector_stores/${s}/files/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=i.response.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){let s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){let s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}content(e,r,n){let{vector_store_id:s}=r;return this._client.getAPIList(se`/vector_stores/${s}/files/${e}/content`,Hi,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var Ua,gO=O(()=>{We();fO();fO();hO();hO();Qt();ir();It();Ua=class extends ae{constructor(){super(...arguments),this.files=new sp(this._client),this.fileBatches=new np(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/vector_stores/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/vector_stores/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",pt,{query:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(se`/vector_stores/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(se`/vector_stores/${e}/search`,Hi,{body:r,method:"post",...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Ua.Files=sp;Ua.FileBatches=np});var $l,yO=O(()=>{We();Qt();ir();Wi();It();$l=class extends ae{create(e,r){return this._client.post("/videos",VC({body:e,...r},this._client))}retrieve(e,r){return this._client.get(se`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Ra,{query:e,...r})}delete(e,r){return this._client.delete(se`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(se`/videos/${e}/content`,{query:r,...n,headers:xe([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(se`/videos/${e}/remix`,VC({body:r,...n},this._client))}}});var ip,$G,yw,Ul,bO=O(()=>{Ls();di();We();ir();Ul=class extends ae{constructor(){super(...arguments),ip.add(this)}async unwrap(e,r,n=this._client.webhookSecret,s=300){return await this.verifySignature(e,r,n,s),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");X(this,ip,"m",$G).call(this,n);let i=xe([r]).values,a=X(this,ip,"m",yw).call(this,i,"webhook-signature"),o=X(this,ip,"m",yw).call(this,i,"webhook-timestamp"),l=X(this,ip,"m",yw).call(this,i,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new ui("Invalid webhook timestamp format");let m=Math.floor(Date.now()/1e3);if(m-u>s)throw new ui("Webhook timestamp is too old");if(u>m+s)throw new ui("Webhook timestamp is too new");let g=a.split(" ").map(E=>E.startsWith("v1,")?E.substring(3):E),v=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),w=l?`${l}.${o}.${e}`:`${o}.${e}`,x=await crypto.subtle.importKey("raw",v,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let E of g)try{let C=Buffer.from(E,"base64");if(await crypto.subtle.verify("HMAC",x,C,new TextEncoder().encode(w)))return}catch{continue}throw new ui("The given webhook signature does not match the expected signature")}};ip=new WeakSet,$G=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},yw=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n}});var UG=O(()=>{bG();vG();yA();bA();NA();MA();LA();UA();BA();VA();GA();XA();eO();tO();rO();nO();aO();dO();mO();gO();yO();bO()});var vO,wO,bw,BG,Oe,vw=O(()=>{Ls();xC();Oa();Pd();$v();IC();mh();$V();WV();PC();Fi();Qt();zC();UG();Kv();bA();MA();BA();GA();tO();rO();nO();yO();bO();yA();NA();mA();LA();UA();VA();XA();eO();aO();dO();mO();gO();IC();ir();CA();hh();Oa();Oe=class{constructor({baseURL:e=pi("OPENAI_BASE_URL"),apiKey:r=pi("OPENAI_API_KEY"),organization:n=pi("OPENAI_ORG_ID")??null,project:s=pi("OPENAI_PROJECT_ID")??null,webhookSecret:i=pi("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(vO.add(this),bw.set(this,void 0),this.completions=new Tl(this),this.chat=new Mo(this),this.embeddings=new Al(this),this.files=new kl(this),this.images=new jl(this),this.audio=new Ki(this),this.moderations=new Ll(this),this.models=new Dl(this),this.fineTuning=new hi(this),this.graders=new qo(this),this.vectorStores=new Ua(this),this.webhooks=new Ul(this),this.beta=new fi(this),this.batches=new Sl(this),this.uploads=new Vo(this),this.responses=new $a(this),this.realtime=new La(this),this.conversations=new Uo(this),this.evals=new Bo(this),this.containers=new $o(this),this.videos=new $l(this),r===void 0)throw new Ae("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:s,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&NV())throw new Ae(`It looks like you're running in a browser-like environment.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
Ae [Error]: Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.
    at new Oe (/opt/render/project/src/dist/index.cjs:91:54511)
    at /opt/render/project/src/dist/index.cjs:129:660
    at /opt/render/project/src/dist/index.cjs:1:230
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:2197:2936)
    at Module._compile (node:internal/modules/cjs/loader:1760:14)
    at Object..js (node:internal/modules/cjs/loader:1892:10)
    at Module.load (node:internal/modules/cjs/loader:1480:32)
    at Module._load (node:internal/modules/cjs/loader:1299:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:245:24)
Node.js v25.3.0
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
==> Running 'npm run start'
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:91
${ow(t)}`);return{...J,id:L,type:Z,function:{...Ce,name:ce,arguments:ue}}})}}:{...w,message:{...D,content:x,role:U,refusal:u.refusal??null},finish_reason:m,index:g,logprobs:v}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return oG(l,e)}function ow(t){return JSON.stringify(t)}var $r,Ma,kd,No,oA,iw,cA,lA,uA,aw,dA,gG,xl,cw=O(()=>{Ls();hG();di();Ph();aA();tA();xl=class t extends Od{constructor(e){super(),$r.add(this),Ma.set(this,void 0),kd.set(this,void 0),No.set(this,void 0),Ke(this,Ma,e,"f"),Ke(this,kd,[],"f")}get currentChatCompletionSnapshot(){return X(this,No,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let s=new t(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),X(this,$r,"m",oA).call(this);let i=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of i)X(this,$r,"m",cA).call(this,a);if(i.controller.signal?.aborted)throw new _r;return this._addChatCompletion(X(this,$r,"m",aw).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),X(this,$r,"m",oA).call(this),this._connected();let s=zi.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(X(this,$r,"m",aw).call(this)),X(this,$r,"m",cA).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new _r;return this._addChatCompletion(X(this,$r,"m",aw).call(this))}[(Ma=new WeakMap,kd=new WeakMap,No=new WeakMap,$r=new WeakSet,oA=function(){this.ended||Ke(this,No,void 0,"f")},iw=function(r){let n=X(this,kd,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},X(this,kd,"f")[r.index]=n,n)},cA=function(r){if(this.ended)return;let n=X(this,$r,"m",gG).call(this,r);this._emit("chunk",r,n);for(let s of r.choices){let i=n.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=X(this,$r,"m",iw).call(this,i);i.finish_reason&&(X(this,$r,"m",uA).call(this,i),a.current_tool_call_index!=null&&X(this,$r,"m",lA).call(this,i,a.current_tool_call_index));for(let o of s.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(X(this,$r,"m",uA).call(this,i),a.current_tool_call_index!=null&&X(this,$r,"m",lA).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let l=i.message.tool_calls?.[o.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:o.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(l?.type,void 0))}}},lA=function(r,n){if(X(this,$r,"m",iw).call(this,r).done_tool_calls.has(n))return;let i=r.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=X(this,Ma,"f")?.tools?.find(o=>xh(o)&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:wl(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},uA=function(r){let n=X(this,$r,"m",iw).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let s=X(this,$r,"m",dA).call(this);this._emit("content.done",{content:r.message.content,parsed:s?s.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},aw=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");let r=X(this,No,"f");if(!r)throw new Ae("request ended without sending any chunks");return Ke(this,No,void 0,"f"),Ke(this,kd,[],"f"),_1e(r,X(this,Ma,"f"))},dA=function(){let r=X(this,Ma,"f")?.response_format;return Sh(r)?r:null},gG=function(r){var n,s,i,a;let o=X(this,No,"f"),{choices:l,...u}=r;o?Object.assign(o,u):o=Ke(this,No,{...u,choices:[]},"f");for(let{delta:m,finish_reason:g,index:v,logprobs:w=null,...x}of r.choices){let E=o.choices[v];if(E||(E=o.choices[v]={finish_reason:g,index:v,message:{},logprobs:w,...x}),w)if(!E.logprobs)E.logprobs=Object.assign({},w);else{let{content:Z,refusal:L,...J}=w;Object.assign(E.logprobs,J),Z&&((n=E.logprobs).content??(n.content=[]),E.logprobs.content.push(...Z)),L&&((s=E.logprobs).refusal??(s.refusal=[]),E.logprobs.refusal.push(...L))}if(g&&(E.finish_reason=g,X(this,Ma,"f")&&HC(X(this,Ma,"f")))){if(g==="length")throw new xd;if(g==="content_filter")throw new Sd}if(Object.assign(E,x),!m)continue;let{content:C,refusal:D,function_call:U,role:N,tool_calls:$,...Q}=m;if(Object.assign(E.message,Q),D&&(E.message.refusal=(E.message.refusal||"")+D),N&&(E.message.role=N),U&&(E.message.function_call?(U.name&&(E.message.function_call.name=U.name),U.arguments&&((i=E.message.function_call).arguments??(i.arguments=""),E.message.function_call.arguments+=U.arguments)):E.message.function_call=U),C&&(E.message.content=(E.message.content||"")+C,!E.message.refusal&&X(this,$r,"m",dA).call(this)&&(E.message.parsed=iA(E.message.content))),$){E.message.tool_calls||(E.message.tool_calls=[]);for(let{index:Z,id:L,type:J,function:ue,...ce}of $){let Ce=(a=E.message.tool_calls)[Z]??(a[Z]={});Object.assign(Ce,ce),L&&(Ce.id=L),J&&(Ce.type=J),ue&&(Ce.function??(Ce.function={name:ue.name??"",arguments:""})),ue?.name&&(Ce.function.name=ue.name),ue?.arguments&&(Ce.function.arguments+=ue.arguments,cG(X(this,Ma,"f"),Ce)&&(Ce.function.parsed_arguments=iA(Ce.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new zi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}});var Oh,pA=O(()=>{cw();Oh=class t extends xl{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let s=new t(r),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,i)),s}}});var ja,kh=O(()=>{We();Jv();Jv();Qt();It();rA();pA();cw();Ph();pA();YC();cw();rA();ja=class extends ae{constructor(){super(...arguments),this.messages=new vl(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(se`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(se`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/chat/completions/${e}`,r)}parse(e,r){return uG(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>_h(n,e))}runTools(e,r){return e.stream?Oh.runTools(this._client,e,r):Ah.runTools(this._client,e,r)}stream(e,r){return xl.createChatCompletion(this._client,e,r)}};ja.Messages=vl});var Mo,mA=O(()=>{We();kh();kh();Mo=class extends ae{constructor(){super(...arguments),this.completions=new ja(this._client)}};Mo.Completions=ja});var yG=O(()=>{kh();kh();Jv()});var bG=O(()=>{mA();yG()});var vG=O(()=>{});function*I1e(t){if(!t)return;if(wG in t){let{values:n,nulls:s}=t;yield*n.entries();for(let i of s)yield[i,null];return}let e=!1,r;t instanceof Headers?r=t.entries():SC(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let i=SC(n[1])?n[1]:[n[1]],a=!1;for(let o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}var wG,xe,ir=O(()=>{Oa();wG=Symbol("brand.privateNullableHeaders");xe=t=>{let e=new Headers,r=new Set;for(let n of t){let s=new Set;for(let[i,a]of I1e(n)){let o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),r.add(o)):(e.append(i,a),r.delete(o))}}return{[wG]:!0,values:e,nulls:r}}});var Rd,fA=O(()=>{We();ir();Rd=class extends ae{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:xe([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}}});var Nd,hA=O(()=>{We();Wi();Nd=class extends ae{create(e,r){return this._client.post("/audio/transcriptions",gs({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}});var Md,gA=O(()=>{We();Wi();Md=class extends ae{create(e,r){return this._client.post("/audio/translations",gs({body:e,...r,__metadata:{model:e.model}},this._client))}}});var Ki,yA=O(()=>{We();fA();fA();hA();hA();gA();gA();Ki=class extends ae{constructor(){super(...arguments),this.transcriptions=new Nd(this._client),this.translations=new Md(this._client),this.speech=new Rd(this._client)}};Ki.Transcriptions=Nd;Ki.Translations=Md;Ki.Speech=Rd});var Sl,bA=O(()=>{We();Qt();It();Sl=class extends ae{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(se`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",pt,{query:e,...r})}cancel(e,r){return this._client.post(se`/batches/${e}/cancel`,r)}}});var jd,vA=O(()=>{We();Qt();ir();It();jd=class extends ae{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/assistants/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/assistants/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",pt,{query:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(se`/assistants/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var Dd,wA=O(()=>{We();ir();Dd=class extends ae{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var Ld,xA=O(()=>{We();ir();Ld=class extends ae{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}});var jo,SA=O(()=>{We();wA();wA();xA();xA();jo=class extends ae{constructor(){super(...arguments),this.sessions=new Dd(this._client),this.transcriptionSessions=new Ld(this._client)}};jo.Sessions=Dd;jo.TranscriptionSessions=Ld});var $d,_A=O(()=>{We();ir();It();$d=class extends ae{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(se`/chatkit/sessions/${e}/cancel`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}}});var Ud,PA=O(()=>{We();Qt();ir();It();Ud=class extends ae{retrieve(e,r){return this._client.get(se`/chatkit/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Ra,{query:e,...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(se`/chatkit/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(se`/chatkit/threads/${e}/items`,Ra,{query:r,...n,headers:xe([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}});var Do,IA=O(()=>{We();_A();_A();PA();PA();Do=class extends ae{constructor(){super(...arguments),this.sessions=new $d(this._client),this.threads=new Ud(this._client)}};Do.Sessions=$d;Do.Threads=Ud});var Bd,EA=O(()=>{We();Qt();ir();It();Bd=class extends ae{create(e,r,n){return this._client.post(se`/threads/${e}/messages`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:s}=r;return this._client.get(se`/threads/${s}/messages/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/messages/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/threads/${e}/messages`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:s}=r;return this._client.delete(se`/threads/${s}/messages/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var qd,TA=O(()=>{We();Qt();ir();It();qd=class extends ae{retrieve(e,r,n){let{thread_id:s,run_id:i,...a}=r;return this._client.get(se`/threads/${s}/runs/${i}/steps/${e}`,{query:a,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:s,...i}=r;return this._client.getAPIList(se`/threads/${s}/runs/${e}/steps`,pt,{query:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var xG,SG=O(()=>{Fi();Gv();xG=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}}});var pi,CA=O(()=>{pi=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()}});var Rh=O(()=>{Oa();SG();CA();hh();xC();Pd()});var cn,Pl,AA,Qi,lw,mi,Il,Fd,_l,pw,ys,uw,dw,jh,Nh,Mh,_G,PG,IG,EG,TG,CG,AG,Da,OA=O(()=>{Ls();aA();di();nw();Rh();Da=class extends Ro{constructor(){super(...arguments),cn.add(this),AA.set(this,[]),Qi.set(this,{}),lw.set(this,{}),mi.set(this,void 0),Il.set(this,void 0),Fd.set(this,void 0),_l.set(this,void 0),pw.set(this,void 0),ys.set(this,void 0),uw.set(this,void 0),dw.set(this,void 0),jh.set(this,void 0)}[(AA=new WeakMap,Qi=new WeakMap,lw=new WeakMap,mi=new WeakMap,Il=new WeakMap,Fd=new WeakMap,_l=new WeakMap,pw=new WeakMap,ys=new WeakMap,uw=new WeakMap,dw=new WeakMap,jh=new WeakMap,cn=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new Pl;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=zi.fromReadableStream(e,this.controller);for await(let i of s)X(this,cn,"m",Nh).call(this,i);if(s.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}toReadableStream(){return new zi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s){let i=new Pl;return i._run(()=>i._runToolAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,r,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(r,a,{...s,signal:this.controller.signal});this._connected();for await(let l of o)X(this,cn,"m",Nh).call(this,l);if(o.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}static createThreadAssistantStream(e,r,n){let s=new Pl;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){let i=new Pl;return i._run(()=>i._runAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return X(this,uw,"f")}currentRun(){return X(this,dw,"f")}currentMessageSnapshot(){return X(this,mi,"f")}currentRunStepSnapshot(){return X(this,jh,"f")}async finalRunSteps(){return await this.done(),Object.values(X(this,Qi,"f"))}async finalMessages(){return await this.done(),Object.values(X(this,lw,"f"))}async finalRun(){if(await this.done(),!X(this,Il,"f"))throw Error("Final run was not received.");return X(this,Il,"f")}async _createThreadAssistantStream(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let o of a)X(this,cn,"m",Nh).call(this,o);if(a.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}async _createAssistantStream(e,r,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(r,a,{...s,signal:this.controller.signal});this._connected();for await(let l of o)X(this,cn,"m",Nh).call(this,l);if(o.controller.signal?.aborted)throw new _r;return this._addRun(X(this,cn,"m",Mh).call(this))}static accumulateDelta(e,r){for(let[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(_d(i)&&_d(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!_d(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s){return await this._createToolAssistantStream(r,e,n,s)}};Pl=Da,Nh=function(e){if(!this.ended)switch(Ke(this,uw,e,"f"),X(this,cn,"m",IG).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":X(this,cn,"m",AG).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":X(this,cn,"m",PG).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":X(this,cn,"m",_G).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Mh=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");if(!X(this,Il,"f"))throw Error("Final run has not been received");return X(this,Il,"f")},_G=function(e){let[r,n]=X(this,cn,"m",TG).call(this,e,X(this,mi,"f"));Ke(this,mi,r,"f"),X(this,lw,"f")[r.id]=r;for(let s of n){let i=r.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=r.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=X(this,Fd,"f")){if(X(this,_l,"f"))switch(X(this,_l,"f").type){case"text":this._emit("textDone",X(this,_l,"f").text,X(this,mi,"f"));break;case"image_file":this._emit("imageFileDone",X(this,_l,"f").image_file,X(this,mi,"f"));break}Ke(this,Fd,s.index,"f")}Ke(this,_l,r.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(X(this,Fd,"f")!==void 0){let s=e.data.content[X(this,Fd,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,X(this,mi,"f"));break;case"text":this._emit("textDone",s.text,X(this,mi,"f"));break}}X(this,mi,"f")&&this._emit("messageDone",e.data),Ke(this,mi,void 0,"f")}},PG=function(e){let r=X(this,cn,"m",EG).call(this,e);switch(Ke(this,jh,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==X(this,pw,"f")?this._emit("toolCallDelta",i,r.step_details.tool_calls[i.index]):(X(this,ys,"f")&&this._emit("toolCallDone",X(this,ys,"f")),Ke(this,pw,i.index,"f"),Ke(this,ys,r.step_details.tool_calls[i.index],"f"),X(this,ys,"f")&&this._emit("toolCallCreated",X(this,ys,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ke(this,jh,void 0,"f"),e.data.step_details.type=="tool_calls"&&X(this,ys,"f")&&(this._emit("toolCallDone",X(this,ys,"f")),Ke(this,ys,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},IG=function(e){X(this,AA,"f").push(e),this._emit("event",e)},EG=function(e){switch(e.event){case"thread.run.step.created":return X(this,Qi,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=X(this,Qi,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=Pl.accumulateDelta(r,n.delta);X(this,Qi,"f")[e.data.id]=s}return X(this,Qi,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":X(this,Qi,"f")[e.data.id]=e.data;break}if(X(this,Qi,"f")[e.data.id])return X(this,Qi,"f")[e.data.id];throw new Error("No snapshot available")},TG=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in r.content){let a=r.content[i.index];r.content[i.index]=X(this,cn,"m",CG).call(this,i,a)}else r.content[i.index]=i,n.push(i);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},CG=function(e,r){return Pl.accumulateDelta(r,e)},AG=function(e){switch(Ke(this,dw,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Ke(this,Il,e.data,"f"),X(this,ys,"f")&&(this._emit("toolCallDone",X(this,ys,"f")),Ke(this,ys,void 0,"f"));break;case"thread.run.cancelling":break}}});var El,kA=O(()=>{We();TA();TA();Qt();ir();OA();Pd();It();El=class extends ae{constructor(){super(...arguments),this.steps=new qd(this._client)}create(e,r,n){let{include:s,...i}=r;return this._client.post(se`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:s}=r;return this._client.get(se`/threads/${s}/runs/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/runs/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/threads/${e}/runs`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:s}=r;return this._client.post(se`/threads/${s}/runs/${e}/cancel`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(s.id,{thread_id:e},n)}createAndStream(e,r,n){return Da.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,r,n){return Da.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:s,...i}=r;return this._client.post(se`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let s=await this.submitToolOutputs(e,r,n);return await this.poll(s.id,r,n)}submitToolOutputsStream(e,r,n){return Da.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};El.Steps=qd});var Lo,RA=O(()=>{We();EA();EA();kA();kA();ir();OA();It();Lo=class extends ae{constructor(){super(...arguments),this.runs=new El(this._client),this.messages=new Bd(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/threads/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(se`/threads/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Da.createThreadAssistantStream(e,this._client.beta.threads,r)}};Lo.Runs=El;Lo.Messages=Bd});var fi,NA=O(()=>{We();vA();vA();SA();SA();IA();IA();RA();RA();fi=class extends ae{constructor(){super(...arguments),this.realtime=new jo(this._client),this.chatkit=new Do(this._client),this.assistants=new jd(this._client),this.threads=new Lo(this._client)}};fi.Realtime=jo;fi.ChatKit=Do;fi.Assistants=jd;fi.Threads=Lo});var Tl,MA=O(()=>{We();Tl=class extends ae{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}}});var Vd,jA=O(()=>{We();ir();It();Vd=class extends ae{retrieve(e,r,n){let{container_id:s}=r;return this._client.get(se`/containers/${s}/files/${e}/content`,{...n,headers:xe([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}});var Cl,DA=O(()=>{We();jA();jA();Qt();ir();Wi();It();Cl=class extends ae{constructor(){super(...arguments),this.content=new Vd(this._client)}create(e,r,n){return this._client.post(se`/containers/${e}/files`,gs({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:s}=r;return this._client.get(se`/containers/${s}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(se`/containers/${e}/files`,pt,{query:r,...n})}delete(e,r,n){let{container_id:s}=r;return this._client.delete(se`/containers/${s}/files/${e}`,{...n,headers:xe([{Accept:"*/*"},n?.headers])})}};Cl.Content=Vd});var $o,LA=O(()=>{We();DA();DA();Qt();ir();It();$o=class extends ae{constructor(){super(...arguments),this.files=new Cl(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(se`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/containers/${e}`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}};$o.Files=Cl});var Gd,$A=O(()=>{We();Qt();It();Gd=class extends ae{create(e,r,n){let{include:s,...i}=r;return this._client.post(se`/conversations/${e}/items`,{query:{include:s},body:i,...n})}retrieve(e,r,n){let{conversation_id:s,...i}=r;return this._client.get(se`/conversations/${s}/items/${e}`,{query:i,...n})}list(e,r={},n){return this._client.getAPIList(se`/conversations/${e}/items`,Ra,{query:r,...n})}delete(e,r,n){let{conversation_id:s}=r;return this._client.delete(se`/conversations/${s}/items/${e}`,n)}}});var Uo,UA=O(()=>{We();$A();$A();It();Uo=class extends ae{constructor(){super(...arguments),this.items=new Gd(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(se`/conversations/${e}`,r)}update(e,r,n){return this._client.post(se`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(se`/conversations/${e}`,r)}};Uo.Items=Gd});var Al,BA=O(()=>{We();Rh();Al=class extends ae{create(e,r){let n=!!e.encoding_format,s=n?e.encoding_format:"base64";n&&Pr(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...r});return n?i:(Pr(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let l=o.embedding;o.embedding=xG(l)}),a)))}}});var zd,qA=O(()=>{We();Qt();It();zd=class extends ae{retrieve(e,r,n){let{eval_id:s,run_id:i}=r;return this._client.get(se`/evals/${s}/runs/${i}/output_items/${e}`,n)}list(e,r,n){let{eval_id:s,...i}=r;return this._client.getAPIList(se`/evals/${s}/runs/${e}/output_items`,pt,{query:i,...n})}}});var Ol,FA=O(()=>{We();qA();qA();Qt();It();Ol=class extends ae{constructor(){super(...arguments),this.outputItems=new zd(this._client)}create(e,r,n){return this._client.post(se`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:s}=r;return this._client.get(se`/evals/${s}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(se`/evals/${e}/runs`,pt,{query:r,...n})}delete(e,r,n){let{eval_id:s}=r;return this._client.delete(se`/evals/${s}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:s}=r;return this._client.post(se`/evals/${s}/runs/${e}`,n)}};Ol.OutputItems=zd});var Bo,VA=O(()=>{We();FA();FA();Qt();It();Bo=class extends ae{constructor(){super(...arguments),this.runs=new Ol(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(se`/evals/${e}`,r)}update(e,r,n){return this._client.post(se`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/evals/${e}`,r)}};Bo.Runs=Ol});var kl,GA=O(()=>{We();Qt();ir();Pd();di();Wi();It();kl=class extends ae{create(e,r){return this._client.post("/files",gs({body:e,...r},this._client))}retrieve(e,r){return this._client.get(se`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",pt,{query:e,...r})}delete(e,r){return this._client.delete(se`/files/${e}`,r)}content(e,r){return this._client.get(se`/files/${e}/content`,{...r,headers:xe([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Vi(r),a=await this.retrieve(e),Date.now()-i>n)throw new Aa({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}});var Hd,zA=O(()=>{We();Hd=class extends ae{}});var Wd,HA=O(()=>{We();Wd=class extends ae{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}}});var Rl,WA=O(()=>{We();HA();HA();Rl=class extends ae{constructor(){super(...arguments),this.graders=new Wd(this._client)}};Rl.Graders=Wd});var Kd,KA=O(()=>{We();Qt();It();Kd=class extends ae{create(e,r,n){return this._client.getAPIList(se`/fine_tuning/checkpoints/${e}/permissions`,Hi,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(se`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:s}=r;return this._client.delete(se`/fine_tuning/checkpoints/${s}/permissions/${e}`,n)}}});var Nl,QA=O(()=>{We();KA();KA();Nl=class extends ae{constructor(){super(...arguments),this.permissions=new Kd(this._client)}};Nl.Permissions=Kd});var Qd,YA=O(()=>{We();Qt();It();Qd=class extends ae{list(e,r={},n){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/checkpoints`,pt,{query:r,...n})}}});var Ml,JA=O(()=>{We();YA();YA();Qt();It();Ml=class extends ae{constructor(){super(...arguments),this.checkpoints=new Qd(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(se`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",pt,{query:e,...r})}cancel(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/events`,pt,{query:r,...n})}pause(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(se`/fine_tuning/jobs/${e}/resume`,r)}};Ml.Checkpoints=Qd});var hi,XA=O(()=>{We();zA();zA();WA();WA();QA();QA();JA();JA();hi=class extends ae{constructor(){super(...arguments),this.methods=new Hd(this._client),this.jobs=new Ml(this._client),this.checkpoints=new Nl(this._client),this.alpha=new Rl(this._client)}};hi.Methods=Hd;hi.Jobs=Ml;hi.Checkpoints=Nl;hi.Alpha=Rl});var Yd,ZA=O(()=>{We();Yd=class extends ae{}});var qo,eO=O(()=>{We();ZA();ZA();qo=class extends ae{constructor(){super(...arguments),this.graderModels=new Yd(this._client)}};qo.GraderModels=Yd});var jl,tO=O(()=>{We();Wi();jl=class extends ae{createVariation(e,r){return this._client.post("/images/variations",gs({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",gs({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}}});var Dl,rO=O(()=>{We();Qt();It();Dl=class extends ae{retrieve(e,r){return this._client.get(se`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Hi,e)}delete(e,r){return this._client.delete(se`/models/${e}`,r)}}});var Ll,nO=O(()=>{We();Ll=class extends ae{create(e,r){return this._client.post("/moderations",{body:e,...r})}}});var Jd,sO=O(()=>{We();ir();It();Jd=class extends ae{accept(e,r,n){return this._client.post(se`/realtime/calls/${e}/accept`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(se`/realtime/calls/${e}/hangup`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(se`/realtime/calls/${e}/refer`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(se`/realtime/calls/${e}/reject`,{body:r,...n,headers:xe([{Accept:"*/*"},n?.headers])})}}});var Xd,iO=O(()=>{We();Xd=class extends ae{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}}});var La,aO=O(()=>{We();sO();sO();iO();iO();La=class extends ae{constructor(){super(...arguments),this.clientSecrets=new Xd(this._client),this.calls=new Jd(this._client)}};La.ClientSecrets=Xd;La.Calls=Jd});function OG(t,e){return!e||!rIe(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:oO(t,e)}function oO(t,e){let r=t.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:iIe(e,s)};if(s.type==="message"){let i=s.content.map(a=>a.type==="output_text"?{...a,parsed:tIe(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||mw(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let s of n.output)if(s.type==="message"){for(let i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function tIe(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function rIe(t){return!!Sh(t.text?.format)}function nIe(t){return t?.$brand==="auto-parseable-tool"}function sIe(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function iIe(t,e){let r=sIe(t.tools??[],e.name);return{...e,...e,parsed_arguments:nIe(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function mw(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var cO=O(()=>{di();Ph()});function aIe(t,e){return OG(t,e)}var Zd,fw,Fo,hw,kG,RG,NG,MG,gw,jG=O(()=>{Ls();di();nw();cO();gw=class t extends Ro{constructor(e){super(),Zd.add(this),fw.set(this,void 0),Fo.set(this,void 0),hw.set(this,void 0),Ke(this,fw,e,"f")}static createResponse(e,r,n){let s=new t(r);return s._run(()=>s._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),X(this,Zd,"m",kG).call(this);let i,a=null;"response_id"in r?(i=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):i=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of i)X(this,Zd,"m",RG).call(this,o,a);if(i.controller.signal?.aborted)throw new _r;return X(this,Zd,"m",NG).call(this)}[(fw=new WeakMap,Fo=new WeakMap,hw=new WeakMap,Zd=new WeakSet,kG=function(){this.ended||Ke(this,Fo,void 0,"f")},RG=function(r,n){if(this.ended)return;let s=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},i=X(this,Zd,"m",MG).call(this,r);switch(s("event",r),r.type){case"response.output_text.delta":{let a=i.output[r.output_index];if(!a)throw new Ae(`missing output at index ${r.output_index}`);if(a.type==="message"){let o=a.content[r.content_index];if(!o)throw new Ae(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new Ae(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[r.output_index];if(!a)throw new Ae(`missing output at index ${r.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:s(r.type,r);break}},NG=function(){if(this.ended)throw new Ae("stream has ended, this shouldn't happen");let r=X(this,Fo,"f");if(!r)throw new Ae("request ended without sending any events");Ke(this,Fo,void 0,"f");let n=aIe(r,X(this,fw,"f"));return Ke(this,hw,n,"f"),n},MG=function(r){let n=X(this,Fo,"f");if(!n){if(r.type!=="response.created")throw new Ae(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=Ke(this,Fo,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);let i=s.type,a=r.part;i==="message"&&a.type!=="reasoning_text"?s.content.push(a):i==="reasoning"&&a.type==="reasoning_text"&&(s.content||(s.content=[]),s.content.push(a));break}case"response.output_text.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);if(s.type==="message"){let i=s.content[r.content_index];if(!i)throw new Ae(`missing content at index ${r.content_index}`);if(i.type!=="output_text")throw new Ae(`expected content to be 'output_text', got ${i.type}`);i.text+=r.delta}break}case"response.function_call_arguments.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);s.type==="function_call"&&(s.arguments+=r.delta);break}case"response.reasoning_text.delta":{let s=n.output[r.output_index];if(!s)throw new Ae(`missing output at index ${r.output_index}`);if(s.type==="reasoning"){let i=s.content?.[r.content_index];if(!i)throw new Ae(`missing content at index ${r.content_index}`);if(i.type!=="reasoning_text")throw new Ae(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=r.delta}break}case"response.completed":{Ke(this,Fo,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=X(this,hw,"f");if(!e)throw new Ae("stream ended without producing a ChatCompletion");return e}}});var ep,lO=O(()=>{We();Qt();It();ep=class extends ae{list(e,r={},n){return this._client.getAPIList(se`/responses/${e}/input_items`,pt,{query:r,...n})}}});var tp,uO=O(()=>{We();tp=class extends ae{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}}});var $a,dO=O(()=>{cO();jG();We();lO();lO();uO();uO();ir();It();$a=class extends ae{constructor(){super(...arguments),this.inputItems=new ep(this._client),this.inputTokens=new tp(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&mw(n),n))}retrieve(e,r={},n){return this._client.get(se`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&mw(s),s))}delete(e,r){return this._client.delete(se`/responses/${e}`,{...r,headers:xe([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>oO(n,e))}stream(e,r){return gw.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(se`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};$a.InputItems=ep;$a.InputTokens=tp});var rp,pO=O(()=>{We();Wi();It();rp=class extends ae{create(e,r,n){return this._client.post(se`/uploads/${e}/parts`,gs({body:r,...n},this._client))}}});var Vo,mO=O(()=>{We();pO();pO();It();Vo=class extends ae{constructor(){super(...arguments),this.parts=new rp(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(se`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(se`/uploads/${e}/complete`,{body:r,...n})}};Vo.Parts=rp});var DG,LG=O(()=>{DG=async t=>{let e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(let s of r)console.error(s.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n}});var np,fO=O(()=>{We();Qt();ir();Pd();LG();It();np=class extends ae{create(e,r,n){return this._client.post(se`/vector_stores/${e}/file_batches`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:s}=r;return this._client.get(se`/vector_stores/${s}/file_batches/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:s}=r;return this._client.post(se`/vector_stores/${s}/file_batches/${e}/cancel`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n){let{vector_store_id:s,...i}=r;return this._client.getAPIList(se`/vector_stores/${s}/file_batches/${e}/files`,pt,{query:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,r.length),o=this._client,l=r.values(),u=[...n];async function m(v){for(let w of v){let x=await o.files.create({file:w,purpose:"assistants"},s);u.push(x.id)}}let g=Array(a).fill(l).map(m);return await DG(g),await this.createAndPoll(e,{file_ids:u})}}});var sp,hO=O(()=>{We();Qt();ir();Rh();It();sp=class extends ae{create(e,r,n){return this._client.post(se`/vector_stores/${e}/files`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:s}=r;return this._client.get(se`/vector_stores/${s}/files/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:s,...i}=r;return this._client.post(se`/vector_stores/${s}/files/${e}`,{body:i,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(se`/vector_stores/${e}/files`,pt,{query:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:s}=r;return this._client.delete(se`/vector_stores/${s}/files/${e}`,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){let s=xe([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=i.response.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Vi(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){let s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){let s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}content(e,r,n){let{vector_store_id:s}=r;return this._client.getAPIList(se`/vector_stores/${s}/files/${e}/content`,Hi,{...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var Ua,gO=O(()=>{We();fO();fO();hO();hO();Qt();ir();It();Ua=class extends ae{constructor(){super(...arguments),this.files=new sp(this._client),this.fileBatches=new np(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(se`/vector_stores/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(se`/vector_stores/${e}`,{body:r,...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",pt,{query:e,...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(se`/vector_stores/${e}`,{...r,headers:xe([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(se`/vector_stores/${e}/search`,Hi,{body:r,method:"post",...n,headers:xe([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Ua.Files=sp;Ua.FileBatches=np});var $l,yO=O(()=>{We();Qt();ir();Wi();It();$l=class extends ae{create(e,r){return this._client.post("/videos",VC({body:e,...r},this._client))}retrieve(e,r){return this._client.get(se`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Ra,{query:e,...r})}delete(e,r){return this._client.delete(se`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(se`/videos/${e}/content`,{query:r,...n,headers:xe([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(se`/videos/${e}/remix`,VC({body:r,...n},this._client))}}});var ip,$G,yw,Ul,bO=O(()=>{Ls();di();We();ir();Ul=class extends ae{constructor(){super(...arguments),ip.add(this)}async unwrap(e,r,n=this._client.webhookSecret,s=300){return await this.verifySignature(e,r,n,s),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");X(this,ip,"m",$G).call(this,n);let i=xe([r]).values,a=X(this,ip,"m",yw).call(this,i,"webhook-signature"),o=X(this,ip,"m",yw).call(this,i,"webhook-timestamp"),l=X(this,ip,"m",yw).call(this,i,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new ui("Invalid webhook timestamp format");let m=Math.floor(Date.now()/1e3);if(m-u>s)throw new ui("Webhook timestamp is too old");if(u>m+s)throw new ui("Webhook timestamp is too new");let g=a.split(" ").map(E=>E.startsWith("v1,")?E.substring(3):E),v=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),w=l?`${l}.${o}.${e}`:`${o}.${e}`,x=await crypto.subtle.importKey("raw",v,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let E of g)try{let C=Buffer.from(E,"base64");if(await crypto.subtle.verify("HMAC",x,C,new TextEncoder().encode(w)))return}catch{continue}throw new ui("The given webhook signature does not match the expected signature")}};ip=new WeakSet,$G=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},yw=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n}});var UG=O(()=>{bG();vG();yA();bA();NA();MA();LA();UA();BA();VA();GA();XA();eO();tO();rO();nO();aO();dO();mO();gO();yO();bO()});var vO,wO,bw,BG,Oe,vw=O(()=>{Ls();xC();Oa();Pd();$v();IC();mh();$V();WV();PC();Fi();Qt();zC();UG();Kv();bA();MA();BA();GA();tO();rO();nO();yO();bO();yA();NA();mA();LA();UA();VA();XA();eO();aO();dO();mO();gO();IC();ir();CA();hh();Oa();Oe=class{constructor({baseURL:e=pi("OPENAI_BASE_URL"),apiKey:r=pi("OPENAI_API_KEY"),organization:n=pi("OPENAI_ORG_ID")??null,project:s=pi("OPENAI_PROJECT_ID")??null,webhookSecret:i=pi("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(vO.add(this),bw.set(this,void 0),this.completions=new Tl(this),this.chat=new Mo(this),this.embeddings=new Al(this),this.files=new kl(this),this.images=new jl(this),this.audio=new Ki(this),this.moderations=new Ll(this),this.models=new Dl(this),this.fineTuning=new hi(this),this.graders=new qo(this),this.vectorStores=new Ua(this),this.webhooks=new Ul(this),this.beta=new fi(this),this.batches=new Sl(this),this.uploads=new Vo(this),this.responses=new $a(this),this.realtime=new La(this),this.conversations=new Uo(this),this.evals=new Bo(this),this.containers=new $o(this),this.videos=new $l(this),r===void 0)throw new Ae("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:s,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&NV())throw new Ae(`It looks like you're running in a browser-like environment.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
Ae [Error]: Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.
    at new Oe (/opt/render/project/src/dist/index.cjs:91:54511)
    at /opt/render/project/src/dist/index.cjs:129:660
    at /opt/render/project/src/dist/index.cjs:1:230
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:2197:2936)
    at Module._compile (node:internal/modules/cjs/loader:1760:14)
    at Object..js (node:internal/modules/cjs/loader:1892:10)
    at Module.load (node:internal/modules/cjs/loader:1480:32)
    at Module._load (node:internal/modules/cjs/loader:1299:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:245:24)
Node.js v25.3.0
Need better ways to work with logs? Try theRender CLI, Render MCP Server, or set up a log stream integration 