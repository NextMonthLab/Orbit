This is very close to approval, but I want you to make 6 surgical changes before we let Replit touch the code. These are the bits that prevent drift, security headaches, and ‚Äúwhy is this so slow on the Cube?‚Äù moments.

Decision

‚úÖ Approve direction
üü° Approve implementation only after these changes are applied to the plan

‚∏ª

1) Keep /api/orbit/:slug/ask ‚Äî but make the response Orbit-native

Right now the response returns tiles as { type, id, title }. That‚Äôs not enough for a thin client or for your own UI to render consistently.

Change:
Return a UI-ready payload that the Orbit front-end already knows how to render:
	‚Ä¢	replyText
	‚Ä¢	uiIntent (e.g. open_node, highlight_nodes, show_cards, show_diff_prompt)
	‚Ä¢	scenePatch (minimal state mutation)
	‚Ä¢	cards[] (full card objects, not stubs)

That keeps the Cube and web in lockstep.

‚∏ª

2) Don‚Äôt use device_id as a ‚Äúhardware fingerprint‚Äù

On a Pi it‚Äôs doable, but it becomes fragile and privacy-adjacent. You‚Äôll also get support tickets when an SD card swap changes it.

Change:
Use:
	‚Ä¢	device_id as a server-issued UUID
	‚Ä¢	pairing code binds that device to an orbit/tenant
	‚Ä¢	optional device_label (‚ÄúBoardroom Cube‚Äù)

If you want a ‚Äúfingerprint‚Äù, store it as a non-unique hint (e.g. user-agent, hostname) ‚Äî never as identity.

‚∏ª

3) Rate limits are too tight for a ‚Äútalking interface‚Äù

60 asks/hour is 1 per minute. A natural voice session can exceed that.

Change:
	‚Ä¢	MVP: 120 asks/hour per device (2/min average) + burst allowance
	‚Ä¢	Or use token bucket: burst 10, refill 2/min

Also: rate limit by device + tenant, not just device.

‚∏ª

4) SSRF ‚Äúnot applicable‚Äù is wrong (because of Data Sources)

Even if the Cube isn‚Äôt triggering external fetches, the Orbit system does fetch external APIs via Data Sources.

Change:
In the AgoraCube readiness checklist, include:
	‚Ä¢	‚ÄúSSRF protections exist in Data Source fetcher layer‚Äù
	‚Ä¢	‚ÄúDevice endpoints are not SSRF vectors‚Äù

Just be explicit so nobody forgets that ingestion is the real risk surface.

‚∏ª

5) Kiosk mode ‚Äúscroll snap / momentum locked‚Äù is a trap

Scroll physics tweaks tend to break across browsers, and Pi Chromium can be‚Ä¶ quirky.

Change:
MVP kiosk mode should only do:
	‚Ä¢	hide chrome
	‚Ä¢	touch targets
	‚Ä¢	reduced motion
	‚Ä¢	node cap

Leave scroll behaviour alone unless you can prove it improves UX without jank.

‚∏ª

6) Voice Mode should not be v1.1 if AgoraCube‚Äôs whole point is voice

If the Cube‚Äôs differentiator is ‚Äúyou can talk to it‚Äù, we should include basic voice input in MVP, but keep it minimal.

Change:
MVP Voice:
	‚Ä¢	mic button
	‚Ä¢	browser STT if available OR a placeholder integration point
	‚Ä¢	transcript ‚Üí existing sendMessage handler
	‚Ä¢	browser TTS (SpeechSynthesis)

No wake word. No camera. No always-on listening.

‚∏ª

Revised MVP scope (what I‚Äôd green-light)

MVP
	‚Ä¢	kiosk=1 mode (chromeless Orbit UI)
	‚Ä¢	voice=1 mode (mic + TTS toggles)
	‚Ä¢	device pairing + revocable token
	‚Ä¢	/api/orbit/:slug/ask returning UI-ready scenePatch + replyText
	‚Ä¢	snapshot grounding: latest ready snapshots
	‚Ä¢	sensible rate limiting + audit logging

v1.1
	‚Ä¢	server-side premium TTS (optional)
	‚Ä¢	/scene endpoint (only if needed)
	‚Ä¢	snapshot diff UX

‚∏ª

The approval message you can send to Replit (paste this)

# APPROVED ‚Äî Proceed to Implementation (with these adjustments)

Proceed with AgoraCube readiness inside Orbit as proposed, but apply the following changes:

1) /api/orbit/:slug/ask response must be Orbit-UI-ready:
   - include replyText
   - include scenePatch (or uiIntent + minimal state updates)
   - include full cards/objects needed for Orbit to render (not tile stubs)

2) Device identity:
   - device_id must be server-issued UUID (not a hardware fingerprint)
   - pairing code binds device to orbit/tenant
   - allow a device_label for admin UI

3) Rate limiting:
   - increase to support natural voice use (suggest 120 asks/hour + burst, token bucket)
   - rate limit by device + tenant

4) Security checklist must acknowledge SSRF risk exists in Data Sources fetcher layer (even if not in kiosk endpoints)

5) Kiosk UX:
   - do NOT implement custom scroll physics in MVP (no momentum-lock / snap-to-tile)
   - focus on chromeless + touch targets + reduced motion + node cap

6) Voice mode should be included in MVP (basic):
   - mic button + transcript ‚Üí existing sendMessage handler
   - SpeechSynthesis TTS for replies
   - no wake word, no camera, no always-on listening

After implementing, provide:
- a short demo checklist
- pairing flow walkthrough
- sample /ask request/response examples
- notes on how snapshot grounding is applied

If you give me a ‚Äúyes‚Äù, I‚Äôll also tighten the /ask request/response into a mini OpenAPI spec so the Pi team (or future you) can build against it without interpretation.